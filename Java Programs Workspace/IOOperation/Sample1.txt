PACKAGE COM.CONTROLLER;

IMPORT JAVAX.SERVLET.HTTP.HTTPSERVLETREQUEST;
IMPORT JAVAX.SERVLET.HTTP.HTTPSESSION;

IMPORT ORG.SPRINGFRAMEWORK.BEANS.FACTORY.ANNOTATION.AUTOWIRED;
IMPORT ORG.SPRINGFRAMEWORK.STEREOTYPE.CONTROLLER;
IMPORT ORG.SPRINGFRAMEWORK.VALIDATION.BINDINGRESULT;
IMPORT ORG.SPRINGFRAMEWORK.WEB.BIND.ANNOTATION.REQUESTMAPPING;
IMPORT ORG.SPRINGFRAMEWORK.WEB.BIND.ANNOTATION.REQUESTMETHOD;
IMPORT ORG.SPRINGFRAMEWORK.WEB.SERVLET.MODELANDVIEW;

IMPORT COM.BEAN.LOGIN;
IMPORT COM.SERVICE.LOGINSERVICE;

@CONTROLLER
PUBLIC CLASS LOGINCONTROLLER {

	@AUTOWIRED
	LOGINSERVICE LOGINSERVICE;
	@REQUESTMAPPING(VALUE = "LOGINCHECK",METHOD = REQUESTMETHOD.POST)
	PUBLIC MODELANDVIEW STOREEMPLOYEEDETAILS(HTTPSERVLETREQUEST REQ,LOGIN LOGIN,HTTPSESSION SESSION) {
		LOGIN.SETEMAIL(REQ.GETPARAMETER("EMAIL"));
		LOGIN.SETPASSWORD(REQ.GETPARAMETER("PASSWORD"));
		LOGIN.SETTYPEOFUSER(REQ.GETPARAMETER("TYPEOFUSER"));
		
		MODELANDVIEW MAV = NEW MODELANDVIEW();
		IF(LOGIN.GETTYPEOFUSER().EQUALS("ADMIN")) {
			STRING ADMINRESULT = LOGINSERVICE.CHECKADMINUSER(LOGIN);
			IF(ADMINRESULT.EQUALS("SUCCESS")) {
						MAV.SETVIEWNAME("ADMINHOME.JSP");
			}ELSE {
				MAV.ADDOBJECT("MSG", "INVALID USERNAME OR PASSWORD");
				MAV.SETVIEWNAME("INDEX.JSP");
			}
		}ELSE {
			STRING CUSTOMERRESULT = LOGINSERVICE.CHECKCUSTOMERUSER(LOGIN);
			IF(CUSTOMERRESULT.EQUALS("SUCCESS")) {
				SESSION.SETATTRIBUTE("USER", LOGIN.GETEMAIL());
				MAV.SETVIEWNAME("CUSTOMERHOME.JSP");
			}ELSE {
				MAV.ADDOBJECT("MSG", "INVALID USERNAME OR PASSWORD");
				MAV.SETVIEWNAME("INDEX.JSP");
			}
		}
		SESSION.REMOVEATTRIBUTE("PMSG");
		SESSION.REMOVEATTRIBUTE("PRODUCTINFO");
		SESSION.REMOVEATTRIBUTE("PRODUCTUPDATEMSG");
		SESSION.REMOVEATTRIBUTE("ORDERMSG");
		SESSION.REMOVEATTRIBUTE("AMOUNTADDMSG");
		RETURN MAV;
	}
	
	@REQUESTMAPPING(VALUE = "LOGIN",METHOD = REQUESTMETHOD.GET)
	PUBLIC MODELANDVIEW OPENLOGINPAGE() {
		MODELANDVIEW MAV = NEW MODELANDVIEW();
		MAV.SETVIEWNAME("LOGIN.JSP");
		RETURN MAV;
	}
	
	@REQUESTMAPPING(VALUE = "LOGOUT",METHOD = REQUESTMETHOD.GET)
	PUBLIC MODELANDVIEW LOGOUT() {
		MODELANDVIEW MAV = NEW MODELANDVIEW();
		MAV.SETVIEWNAME("INDEX.JSP");
		RETURN MAV;
	}
	
	@REQUESTMAPPING(VALUE = "ADMINDASHBOARD",METHOD = REQUESTMETHOD.GET)
	PUBLIC MODELANDVIEW ADMINDASHBOARD() {
		MODELANDVIEW MAV = NEW MODELANDVIEW();
		MAV.SETVIEWNAME("ADMINHOME.JSP");
		RETURN MAV;
	}
}
